#!/bin/sh

set -e

docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASSWORD

tag=$(date +%s)

mkdir -p /tmp/release
cd /tmp/release

git clone https://github.com/convox/app
cd app
docker build -t convox/app:$tag .

git clone https://github.com/convox/kernel
cd kernel
docker build -t convox/kernel:$tag .

git clone https://github.com/convox/registry
cd registry
docker build -t convox/registry:$tag .

docker push convox/app:$tag
docker push convox/kernel:$tag
docker push convox/registry:$tag

echo "released: $tag"
